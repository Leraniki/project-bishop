# Проект "Бишоп": Ядро Синтетика (Project Bishop: Synthetic Human Core)

**Код доступа:** `OMEGA`
**Статус проекта:** `Прототип завершен`
**Ответственный отдел:** Дирекция по роботизации, Weyland-Yutani Corp.

> Мы строим лучшие миры!

---

## 1. Постановка задачи

После инцидента с андроидом модели "Эш" на корабле «Ностромо» корпорацией было принято стратегическое решение о создании единого программного ядра (`synthetic-human-core-starter`). Данное ядро станет основой для всех будущих моделей синтетиков, обеспечивая унифицированную, надежную и полностью контролируемую логику поведения.

Проект "Бишоп" представляет собой реализацию этого ядра и сервис-эмулятор для демонстрации его возможностей.

## 2. Ключевые модули ядра

Ядро `synthetic-human-core-starter` содержит следующие обязательные модули:

### 2.1. Модуль приема и исполнения команд
- **Формат команд:** Единый JSON-формат с полями `description`, `priority`, `author`, `time`.
- **Приоритезация:**
    - `CRITICAL`: Команды исполняются немедленно, прерывая текущие задачи.
    - `COMMON`: Команды помещаются в очередь для последовательного выполнения.
- **Очередь задач:** Реализована на базе `ThreadPoolTaskExecutor` с ограниченной емкостью для предотвращения перегрузки системы.

### 2.2. Модуль аудита действий (`@WeylandWatchingYou`)
- **Задача:** Протоколирование всех ключевых действий синтетика.
- **Реализация:** Аспектно-ориентированный подход с использованием аннотации `@WeylandWatchingYou`.
- **Режимы аудита:**
    - `console`: Вывод информации в стандартную консоль (для отладки).
    - `kafka`: Отправка данных в указанный Kafka-топик (для централизованного мониторинга).
- **Настройка:** Режим задается в `application.properties` через свойство `weyland.audit.mode`.

### 2.3. Модуль мониторинга занятости
- **Задача:** Сбор метрик для оценки эффективности работы синтетика.
- **Реализация:** Интеграция с `Spring Boot Actuator` и `Micrometer`.
- **Ключевые метрики (доступны по эндпоинту `/actuator/prometheus`):**
    - `android.tasks.in_queue`: Текущее количество задач в очереди.
    - `android.tasks.completed_total`: Общее количество выполненных задач с разбивкой по автору команды (`author`).

### 2.4. Модуль обработки ошибок
- **Задача:** Стандартизация ответов об ошибках в REST API.
- **Реализация:** Глобальный обработчик исключений (`@ControllerAdvice`) для возврата ошибок в едином формате JSON и с корректными HTTP-статусами.

## 3. Структура проекта

Проект является многомодульным Maven-проектом:

- **`synthetic-human-core-starter`**: Библиотека (стартер), содержащая всю основную логику. Не является запускаемым приложением.
- **`bishop-prototype`**: Сервис-эмулятор, который использует стартер и предоставляет REST API для демонстрации его работы.

## 4. Технологический стек

- **Фреймворк:** Spring Boot 3
- **Асинхронность:** `ThreadPoolTaskExecutor`
- **Аудит:** Spring AOP, Spring Kafka
- **Метрики:** Spring Boot Actuator, Micrometer
- **Сборка:** Apache Maven

## 5. Инструкция по запуску и тестированию

### 5.1. Сборка проекта
Для сборки всех модулей выполните команду в корневой директории проекта:
```bash
mvn clean install
```

### 5.2. Запуск эмулятора "Бишоп"
1. Перейдите в модуль `bishop-prototype`.
2. Запустите главный класс `BishopPrototypeApplication.java` из вашей IDE.
3. Приложение запустится на порту `8080`.

### 5.3. Тестирование API
Ниже приведены примеры запросов, которые можно выполнить с помощью любого HTTP-клиента.

**Отправка команды:**
```http
POST http://localhost:8080/api/v1/android/command
Content-Type: application/json

{
  "description": "Проверить состояние энергоблока космического корабля",
  "priority": "COMMON",
  "author": "Лейтенант Эллен Рипли",
  "time": "2024-05-21T10:00:00Z"
}
```

**Проверка аудита:**
```http
GET http://localhost:8080/api/v1/android/status?requester=Даллас
```

**Просмотр метрик:**
Откройте в браузере следующую ссылку, пока приложение запущено:
`http://localhost:8080/actuator/prometheus`

---
**Конфиденциальная информация. Не для распространения за пределами корпорации Weyland-Yutani.**